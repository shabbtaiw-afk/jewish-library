<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>住驻专 转 | 注拽 </title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a365d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Heebo:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a365d; --accent: #d4af37; --success: #2d6a4f; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Assistant', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; }
        header { text-align: center; margin-bottom: 20px; padding-top: 10px; }
        h1 { font-family: 'Heebo'; font-weight: 800; color: var(--primary); margin: 0; font-size: 26px; }
        
        .card { background: white; padding: 20px; border-radius: 28px; box-shadow: 0 10px 25px rgba(26, 54, 93, 0.05); margin-bottom: 15px; border: 1px solid #edf2f7; }
        
        /* Library Header */
        .lib-header { background: linear-gradient(135deg, var(--primary), #2c5282); color: white; padding: 20px; border-radius: 24px; text-align: center; margin-bottom: 15px; }
        
        .progress-bar-container { height: 12px; background: rgba(255,255,255,0.2); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.8s ease; }

        select { width: 100%; padding: 14px; border-radius: 16px; border: 2px solid #e2e8f0; margin-bottom: 10px; font-family: inherit; font-weight: 700; font-size: 16px; appearance: none; background: #fff url('data:image/svg+xml;charset=US-ASCII,<svg%20xmlns="http://www.w3.org/2000/svg"%20width="24"%20height="24"%20viewBox="0%200%2024%2024" fill="none" stroke="%231a365d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6%209%2012%2015%2018%209"></polyline></svg>') no-repeat left 15px center; }
        
        .checklist { max-height: 400px; overflow-y: auto; padding-left: 10px; }
        .chapter-item { display: flex; align-items: center; padding: 14px; border-radius: 15px; margin-bottom: 6px; background: #fdfdfd; border: 1px solid #f1f5f9; transition: all 0.2s; }
        .chapter-item.completed { background: #f0fdf4; border-color: #bcf0da; }
        
        input[type="checkbox"] { width: 24px; height: 24px; margin-left: 15px; accent-color: var(--success); cursor: pointer; }
        .chapter-label { font-size: 18px; font-weight: 600; color: var(--primary); }

        .btn-settings { background: none; border: none; color: #a0aec0; cursor: pointer; font-size: 13px; text-decoration: underline; margin-top: 20px; }
        .settings-panel { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>住驻专 转</h1>
    </header>

    <div class="lib-header">
        <label style="font-size: 13px; opacity: 0.8;">转  专:</label>
        <select id="mainLibrarySelect" onchange="changeLibrary(this.value)" style="background-color: white; border: none; margin-top: 8px;"></select>
        
        <div class="progress-bar-container"><div class="progress-bar-fill" id="progressBar"></div></div>
        <div id="progressText" style="font-size: 14px; font-weight: 700;">0/0 驻专拽 砖</div>
    </div>

    <div class="card" style="background: #edf2f7; border: none;">
        <select id="volumeSelect" onchange="updateUnits()"></select>
        <select id="unitSelect" onchange="render()"></select>
    </div>

    <div class="card">
        <b id="listTitle" style="color: var(--primary); font-size: 18px; display: block; margin-bottom: 12px;">专砖转 </b>
        <div id="chapterList" class="checklist"></div>
    </div>

    <button class="btn-settings" onclick="toggleSettings()">专转  转</button>
    
    <div id="settings" class="card settings-panel">
        <b style="font-size: 14px;">转专转 </b>
        <div style="margin-top: 10px;">
            <label style="font-size: 11px; display: block;">转专转 转:</label>
            <input type="time" id="reminderTime" onchange="saveReminder(this.value)" style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
            <button onclick="Notification.requestPermission()" style="width: 100%; margin-top: 10px; padding: 10px; border-radius: 10px; background: var(--primary); color: white; border: none; font-weight: 700;"> 驻注 转专转</button>
        </div>
        <hr style="margin: 20px 0; opacity: 0.1;">
        <button onclick="exportData()" style="width: 100%; padding: 10px; border-radius: 10px; background: #64748b; color: white; border: none; font-weight: 700;"> 砖专 </button>
    </div>
</div>

<script>
    const library = {
        "Tanakh": {
            name: "转\"",
            data: [
                { b: "转专", h: "专砖转", c: 50 }, { b: "转专", h: "砖转", c: 40 }, { b: "转专", h: "拽专", c: 27 }, { b: "转专", h: "专", c: 36 }, { b: "转专", h: "专", c: 34 },
                { b: "", h: "砖注", c: 24 }, { b: "", h: "砖驻", c: 21 }, { b: "", h: "砖 ", c: 31 }, { b: "", h: "砖 ", c: 24 }, { b: "", h: " ", c: 22 }, { b: "", h: " ", c: 25 }, { b: "", h: "砖注", c: 66 }, { b: "", h: "专", c: 52 }, { b: "", h: "拽", c: 48 },
                { b: "转专 注砖专", h: "砖注", c: 14 }, { b: "转专 注砖专", h: "", c: 4 }, { b: "转专 注砖专", h: "注住", c: 9 }, { b: "转专 注砖专", h: "注", c: 1 }, { b: "转专 注砖专", h: "", c: 4 }, { b: "转专 注砖专", h: "", c: 7 }, { b: "转专 注砖专", h: "", c: 3 }, { b: "转专 注砖专", h: "拽拽", c: 3 }, { b: "转专 注砖专", h: "爪驻", c: 3 }, { b: "转专 注砖专", h: "", c: 2 }, { b: "转专 注砖专", h: "专", c: 14 }, { b: "转专 注砖专", h: "", c: 3 },
                { b: "转", h: "转", c: 150 }, { b: "转", h: "砖", c: 31 }, { b: "转", h: "", c: 42 }, { b: "转", h: "转", c: 34 }, { b: "转", h: "", c: 12 }, { b: "转", h: "注专 ", c: 23 }, { b: "转", h: "专 ", c: 65 }
            ]
        },
        "Bavli": {
            name: "转 ",
            data: [
                { b: "注", h: "专转", c: 63 }, { b: "注", h: "砖转", c: 156 }, { b: "注", h: "注专", c: 104 }, { b: "注", h: "驻住", c: 120 }, { b: "注", h: "", c: 87 }, { b: "注", h: "住", c: 55 }, { b: "注", h: "爪", c: 39 }, { b: "注", h: "专砖 砖", c: 34 }, { b: "注", h: "转注转", c: 30 }, { b: "注", h: "", c: 31 }, { b: "注", h: "注 拽", c: 27 }, { b: "注", h: "", c: 26 },
                { b: "砖", h: "转", c: 121 }, { b: "砖", h: "转转", c: 111 }, { b: "砖", h: "专", c: 90 }, { b: "砖", h: "专", c: 65 }, { b: "砖", h: "住", c: 48 }, { b: "砖", h: "", c: 89 }, { b: "砖", h: "拽砖", c: 81 },
                { b: "拽", h: " 拽", c: 118 }, { b: "拽", h: " 爪注", c: 118 }, { b: "拽", h: " 转专", c: 175 }, { b: "拽", h: "住专", c: 112 }, { b: "拽", h: "转", c: 23 }, { b: "拽", h: "砖注转", c: 48 }, { b: "拽", h: "注 专", c: 75 }, { b: "拽", h: "专转", c: 13 },
                { b: "拽砖", h: "", c: 119 }, { b: "拽砖", h: "转", c: 109 }, { b: "拽砖", h: "", c: 141 }, { b: "拽砖", h: "专转", c: 60 }, { b: "拽砖", h: "注专", c: 33 }, { b: "拽砖", h: "转专", c: 33 }, { b: "拽砖", h: "专转转", c: 27 }, { b: "拽砖", h: "注", c: 21 }, { b: "拽砖", h: "", c: 72 }
            ]
        },
        "Yerushalmi": {
            name: "转 专砖",
            data: [
                { b: "专注", h: "专转", c: 68 }, { b: "专注", h: "驻", c: 37 }, { b: "专注", h: "", c: 34 }, { b: "专注", h: "", c: 44 }, { b: "专注", h: "砖注转", c: 31 }, { b: "专注", h: "转专转", c: 59 }, { b: "专注", h: "注砖专转", c: 26 }, { b: "专注", h: "注砖专 砖", c: 33 }, { b: "专注", h: "", c: 28 }, { b: "专注", h: "注专", c: 20 }, { b: "专注", h: "专", c: 13 },
                { b: "注", h: "砖转", c: 92 }, { b: "注", h: "注专", c: 65 }, { b: "注", h: "驻住", c: 71 }, { b: "注", h: "", c: 42 }, { b: "注", h: "砖拽", c: 33 }, { b: "注", h: "住", c: 26 }, { b: "注", h: "爪", c: 22 }, { b: "注", h: "专砖 砖", c: 22 }, { b: "注", h: "转注转", c: 26 }, { b: "注", h: "", c: 34 }, { b: "注", h: "注 拽", c: 19 }, { b: "注", h: "", c: 22 }
            ]
        },
        "Mishnah": {
            name: "砖",
            data: [
                { b: "专注", h: "专转", c: 9 }, { b: "专注", h: "驻", c: 8 }, { b: "注", h: "砖转", c: 24 }, { b: "注", h: "注专", c: 10 }, { b: "砖", h: "转", c: 16 }, { b: "拽", h: " 拽", c: 10 }
            ]
        },
        "Halacha": {
            name: "",
            data: [
                { b: "砖 注专", h: "专 ", c: 697 }, { b: "砖 注专", h: "专 注", c: 403 }, { b: "砖 注专", h: " 注专", c: 178 }, { b: "砖 注专", h: "砖 砖驻", c: 427 },
                { b: "专\"", h: "注", c: 46 }, { b: "专\"", h: "", c: 45 }, { b: "专\"", h: "", c: 97 }
            ]
        }
    };

    let currentBook = localStorage.getItem('jewish_lib_book') || "Tanakh";
    let completed = JSON.parse(localStorage.getItem('jewish_lib_done_' + currentBook)) || [];

    window.onload = () => {
        const sel = document.getElementById('mainLibrarySelect');
        for(let k in library) {
            let o = document.createElement('option'); o.value = k; o.text = library[k].name;
            if(k === currentBook) o.selected = true;
            sel.add(o);
        }
        updateVolumes();
        setInterval(checkReminder, 60000);
    };

    function changeLibrary(key) {
        currentBook = key;
        localStorage.setItem('jewish_lib_book', key);
        completed = JSON.parse(localStorage.getItem('jewish_lib_done_' + key)) || [];
        updateVolumes();
    }

    function updateVolumes() {
        const vSel = document.getElementById('volumeSelect'); vSel.innerHTML = "";
        const volumes = [...new Set(library[currentBook].data.map(i => i.b))];
        volumes.forEach(v => {
            let o = document.createElement('option'); o.value = v; o.text = v;
            vSel.add(o);
        });
        updateUnits();
    }

    function updateUnits() {
        const uSel = document.getElementById('unitSelect'); uSel.innerHTML = "";
        const vol = document.getElementById('volumeSelect').value;
        library[currentBook].data.filter(i => i.b === vol).forEach(i => {
            let o = document.createElement('option'); o.value = i.h; o.text = i.h;
            uSel.add(o);
        });
        render();
    }

    function render() {
        const bookData = library[currentBook].data;
        const total = bookData.reduce((s, i) => s + i.c, 0);
        document.getElementById('progressText').innerText = `${completed.length} / ${total} 驻专拽 砖`;
        document.getElementById('progressBar').style.width = (completed.length / total * 100) + "%";

        const curVol = document.getElementById('volumeSelect').value;
        const curUnit = document.getElementById('unitSelect').value;
        document.getElementById('listTitle').innerText = curUnit;

        let html = ""; let globalIdx = 0;
        bookData.forEach(item => {
            if(item.b === curVol && item.h === curUnit) {
                for(let p=1; p<=item.c; p++) {
                    const id = globalIdx + p;
                    const isDone = completed.includes(id);
                    let label = (currentBook === 'Bavli' || currentBook === 'Yerushalmi') ? '祝 ' + (p+1) : '驻专拽 ' + p;
                    if(curVol.includes('砖 注专')) label = '住 ' + p;
                    html += `<div class="chapter-item ${isDone?'completed':''}">
                        <input type="checkbox" ${isDone?'checked':''} onclick="toggle(${id})">
                        <span class="chapter-label">${label}</span>
                    </div>`;
                }
            }
            globalIdx += item.c;
        });
        document.getElementById('chapterList').innerHTML = html;
    }

    function toggle(id) {
        let idx = completed.indexOf(id);
        if(idx > -1) completed.splice(idx, 1); else completed.push(id);
        localStorage.setItem('jewish_lib_done_' + currentBook, JSON.stringify(completed));
        render();
    }

    function checkReminder() {
        const time = localStorage.getItem('jewish_lib_reminder');
        if(!time) return;
        const now = new Date();
        const cur = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        if(cur === time) new Notification("  !", { body: " 转砖 砖 转 住驻拽  砖 住驻专." });
    }
    function saveReminder(v) { localStorage.setItem('jewish_lib_reminder', v); }
    function toggleSettings() { let s = document.getElementById('settings').style; s.display = s.display==='block'?'none':'block'; }
    function exportData() {
        const b = new Blob([JSON.stringify(completed)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = `jewish_lib_${currentBook}.json`; a.click();
    }
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>
